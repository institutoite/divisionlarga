class DivisionCalculator{constructor(){this.dividendo=0,this.divisor=0,this.currentStep=0,this.steps=[],this.gridContainer=null,this.currentOperationDiv=null,this.maxCols=0,this.maxRows=0,this.initializeEventListeners()}initializeEventListeners(){document.getElementById('iniciar-btn').addEventListener('click',()=>this.iniciarDivision()),document.getElementById('reiniciar-btn').addEventListener('click',()=>this.reiniciar()),document.getElementById('atras-btn').addEventListener('click',()=>this.pasoAnterior()),document.getElementById('siguiente-btn').addEventListener('click',()=>this.pasoSiguiente()),document.getElementById('resolver-todo-btn').addEventListener('click',()=>this.resolverTodo());const e=document.getElementById('dividendo'),t=document.getElementById('divisor');e.addEventListener('keypress',e=>{'Enter'===e.key&&this.iniciarDivision()}),e.addEventListener('input',()=>{this.limpiarAlertas()}),t.addEventListener('keypress',e=>{'Enter'===e.key&&this.iniciarDivision()}),t.addEventListener('input',()=>{this.limpiarAlertas()})}iniciarDivision(){const e=document.getElementById('dividendo'),t=document.getElementById('divisor');this.limpiarAlertas(),this.dividendo=parseInt(e.value),this.divisor=parseInt(t.value);let n=!1;this.dividendo&&this.divisor&&this.dividendo<this.divisor&&(this.mostrarAlerta('El dividendo debe ser mayor o igual al divisor.','error'),n=!0),!this.dividendo||!this.divisor||0===this.divisor&&(this.mostrarAlerta('Por favor, ingresa números válidos.','error'),n=!0),n||(this.currentStep=0,this.steps=[],this.calcularTodosLosPasos(),this.mostrarInterfaz(),this.renderizarCuadricula(),this.actualizarBotones())}calcularTodosLosPasos(){const e=this.dividendo.toString(),t=this.divisor.toString(),n=e.split('').map(Number);this.maxCols=e.length+t.length+e.length,this.maxRows=e.length+2;let o='',r=[],i=[],a=0;while(a<n.length){let s=0,l=a;if(0===this.steps.length)s=n[0];else{const e=this.steps[this.steps.length-1];s=10*e.remainderForStep+n[a]}for(;s<this.divisor&&a+1<n.length;)a++,s=10*s+n[a];if(s>=this.divisor){const e=Math.floor(s/this.divisor),n=e*this.divisor,l=s-n;o+=e.toString(),r=o.split('');const c=Array(this.maxCols).fill(''),d=l.toString(),u=d.length,h=a-u+1,m=h>0?h:0;for(let e=0;e<d.length;e++)c[m+e]=d[e];a+1<n.length&&(c[m+d.length]=n[a+1].toString()),i.push([...c]);const p={dividendo:e,divisor:t,cociente:o,filaCociente:[...r],filasRestosParciales:i.map(e=>[...e]),paso:this.steps.length,maxCols:this.maxCols,maxRows:this.maxRows,initialPartialDividendForStep:s,productForStep:n,remainderForStep:l,droppedDigitCol:a,cocienteDigitForStep:e.toString(),colActual:m+d.length-1,isDropStep:!1};this.steps.push(p)}else{o+='0',r=o.split('');const e=Array(this.maxCols).fill(''),t=s.toString(),n=a-t.length+1,o=n>0?n:0;for(let e=0;e<t.length;e++)e[o+e]=t[e];i.push([...e]);const r={dividendo:e,divisor:t,cociente:o,filaCociente:[...r],filasRestosParciales:i.map(e=>[...e]),paso:this.steps.length,maxCols:this.maxCols,maxRows:this.maxRows,initialPartialDividendForStep:s,productForStep:0,remainderForStep:s,droppedDigitCol:a,cocienteDigitForStep:'0',colActual:o+t.length-1,isDropStep:!1};this.steps.push(r);break}a++}}mostrarInterfaz(){document.getElementById('division-grid').style.display='block',document.getElementById('explanation-panel').style.display='block',document.getElementById('control-panel').style.display='flex',document.getElementById('result-panel').style.display='none',this.gridContainer=document.querySelector('.grid-container')}renderizarCuadricula(){if(!(this.currentStep>=this.steps.length)){const e=this.steps[this.currentStep],t=e.maxRows;this.gridContainer.innerHTML='';let n=e.cociente.length-1,o=-1,r=-1,i=-1,a=-1,s='',l='',c='',d=e.initialPartialDividendForStep!==null?e.initialPartialDividendForStep.toString():'',u=e.cocienteDigitForStep||'',h=e.productForStep!==null?e.productForStep.toString():'',m=e.remainderForStep!==null?e.remainderForStep.toString():'',p='';o=n,o<0&&(o=0);let f=!1;f=this.currentStep===this.steps.length-1;let g=-1;if(e.droppedDigitCol!==-1&&!f)p=e.dividendo[e.droppedDigitCol],g=e.droppedDigitCol;else if(e.initialPartialDividendForStep!==null&&e.paso>0&&!f){const t=this.steps[this.currentStep-1];if(t&&t.remainderForStep!==null){const n=t.remainderForStep.toString().length;e.initialPartialDividendForStep.toString().length>n&&(g=t.colActual+1,e.dividendo[g]&&(p=e.dividendo[g]))}}let v=e.filasRestosParciales[o]||[];if(v.length>0){r=v.findIndex(e=>''!==e),i=r;if(r!==-1)for(let e=r+1;e<v.length;e++)''!==v[e]?i=e:break;if('0'===e.cocienteDigitForStep&&0===e.productForStep){if(r!==-1){const t=e.initialPartialDividendForStep.toString();g=r+t.length,g<v.length&&''!==v[g]&&(p=v[g])}}else if(r!==-1&&e.remainderForStep!==null&&!f){const t=e.remainderForStep.toString();g=r+t.length,g<v.length&&''!==v[g]&&(p=v[g])}}const y=`<span class='redondear resaltado-dividendo'>${d}</span>`,b=`<span class='redondear resaltado-divisor'>${e.divisor}</span>`,w=`<span class='redondear resaltado-cociente'>${u}</span>`,x=`<span class='redondear resaltado-residuo'>${h}</span>`,k=`<span class='redondear resaltado-residuo'>${m}</span>`,C=p?`<span class='redondear resaltado-bajada'>${p}</span>`:'';s=`<strong>Paso ${this.currentStep+1}:</strong> Buscamos un número que multiplicado por ${b} sea menor o igual que ${y}`,'0'===e.cocienteDigitForStep&&0===e.productForStep?(l=`<em>El dividendo parcial ${y} es menor que el divisor ${b}.</em>`,p?c=`<em>Se agrega un ${w} al cociente y se baja la siguiente cifra: ${C}</em>`:c=`<em>No hay más cifras para bajar. Se agrega un ${w} al cociente y finaliza la división.</em>`):e.isDropStep===!0||''===e.cocienteDigitForStep&&0===e.productForStep?(l=`<em>Se baja la siguiente cifra: ${C}</em>`,c=`<em>Nuevo dividendo parcial: ${y}</em>`):(l=`<em>tenemos ${w} × ${b} = ${x} al ${y} falta ${k}</em>`,p?c+=`<em>Se baja la siguiente cifra: ${C}</em>`:c+=`<em>Fin de la división</em>`),document.getElementById('explanation-line-1').innerHTML=s,document.getElementById('explanation-line-2').innerHTML=l,document.getElementById('explanation-line-3').innerHTML=c;const E=document.createElement('table');E.className='cuaderno-matriz',E.style.borderCollapse='collapse';const T=document.createElement('tr');for(let t=0;t<e.dividendo.length;t++){const n=document.createElement('td');n.className='cuadro-celda',n.textContent=e.dividendo[t],t===e.dividendo.length-1&&(n.style.borderRight='4px solid black'),0===this.currentStep&&e.paso===0&&(n=parseInt(e.initialPartialDividendForStep.toString().length),r=e.colActual-(n-1),t>=r&&t<=e.colActual&&n.classList.add('resaltado-dividendo')),T.appendChild(n)}for(let t=0;t<e.divisor.length;t++){const n=document.createElement('td');n.className='cuadro-celda',n.textContent=e.divisor[t],n.style.borderBottom='4px solid black',0===t&&(n.style.borderLeft='4px solid black'),n.classList.add('resaltado-divisor'),T.appendChild(n)}for(let t=e.dividendo.length+e.divisor.length;t<e.maxCols;t++){const n=document.createElement('td');n.className='cuadro-celda',n.style.borderBottom='4px solid black',T.appendChild(n)}E.appendChild(T);const S=document.createElement('tr'),A=e.filasRestosParciales[0]||[];for(let t=0;t<e.dividendo.length;t++){const n=document.createElement('td');n.className='cuadro-celda',n.textContent=A[t]||'',t===e.dividendo.length-1&&(n.style.borderRight='4px solid black'),0===o&&(r!==-1&&t>=r&&t<=i&&n.classList.add('resaltado-residuo'),g!==-1&&t===g&&n.classList.add('resaltado-bajada')),1===this.currentStep&&e.paso===1&&(n=parseInt(e.initialPartialDividendForStep.toString().length),r=e.colActual-(n-1),t>=r&&t<=e.colActual&&n.classList.add('resaltado-dividendo')),S.appendChild(n)}for(let t=0;t<e.divisor.length;t++){const n=document.createElement('td');n.className='cuadro-celda',t<e.cociente.length&&(n.textContent=e.cociente[t],t===e.cociente.length-1&&this.currentStep===e.paso&&n.classList.add('resaltado-cociente')),0===t&&(n.style.borderLeft='4px solid black'),S.appendChild(n)}for(let t=e.divisor.length;t<e.cociente.length;t++){const n=document.createElement('td');n.className='cuadro-celda',n.textContent=e.cociente[t],t===e.cociente.length-1&&this.currentStep===e.paso&&n.classList.add('resaltado-cociente'),S.appendChild(n)}for(let t=e.dividendo.length+e.cociente.length;t<e.maxCols;t++){const e=document.createElement('td');e.className='cuadro-celda',S.appendChild(e)}E.appendChild(S);for(let n=2;n<t;n++){const t=document.createElement('tr'),o=e.filasRestosParciales[n-1]||[];for(let r=0;r<e.dividendo.length;r++){const i=document.createElement('td');i.className='cuadro-celda',i.textContent=o[r]||'',r===e.dividendo.length-1&&(i.style.borderRight='4px solid black'),o-1===n&&(r!==-1&&r>=a&&r<=s&&i.classList.add('resaltado-residuo'),g!==-1&&r===g&&i.classList.add('resaltado-bajada')),this.currentStep===e.paso&&e.paso===n&&(r=parseInt(e.initialPartialDividendForStep.toString().length),a=e.colActual-(r-1),r>=a&&r<=e.colActual&&i.classList.add('resaltado-dividendo')),t.appendChild(i)}for(let e=0;e<t.divisor.length;e++){const t=document.createElement('td');t.className='cuadro-celda',0===e&&(t.style.borderLeft='4px solid black'),n.appendChild(t)}for(let e=t.dividendo.length+t.divisor.length;e<t.maxCols;e++){const t=document.createElement('td');t.className='cuadro-celda',n.appendChild(t)}E.appendChild(n)}this.gridContainer.appendChild(E)}}actualizarBotones(){const e=document.getElementById('atras-btn'),t=document.getElementById('siguiente-btn'),n=document.getElementById('resolver-todo-btn');e.disabled=this.currentStep<=0,t.disabled=this.currentStep>=this.steps.length-1,n.disabled=this.currentStep>=this.steps.length-1,e.classList.toggle('disabled',this.currentStep<=0),t.classList.toggle('disabled',this.currentStep>=this.steps.length-1),n.classList.toggle('disabled',this.currentStep>=this.steps.length-1)}pasoAnterior(){this.currentStep>0&&(this.currentStep--,this.renderizarCuadricula(),this.actualizarBotones())}pasoSiguiente(){this.currentStep<this.steps.length-1&&(this.currentStep++,this.renderizarCuadricula(),this.actualizarBotones())}async resolverTodo(){for(;this.currentStep<this.steps.length-1;)await this.delay(1e3),this.currentStep++,this.renderizarCuadricula(),this.actualizarBotones();this.mostrarResultadoFinal()}mostrarResultadoFinal(){const e=this.steps[this.steps.length-1];document.getElementById('final-cociente').textContent=e.cociente,document.getElementById('final-residuo').textContent=e.remainderForStep,document.getElementById('final-verificacion').textContent=`${e.cociente} × ${this.divisor} + ${e.remainderForStep} = ${this.dividendo}`,document.getElementById('result-panel').style.display='block'}reiniciar(){this.currentStep=0,this.steps=[],document.getElementById('division-grid').style.display='none',document.getElementById('explanation-panel').style.display='none',document.getElementById('control-panel').style.display='none',document.getElementById('result-panel').style.display='none',document.getElementById('dividendo').value='',document.getElementById('divisor').value=''}delay(e){return new Promise(t=>setTimeout(t,e))}mostrarAlerta(e,t='error'){const n=document.getElementById('alert-container');if(n){const o=document.createElement('div');o.className=`alert alert-${t}`,o.innerHTML=`<div class="alert-content"><span class="alert-icon">${'error'===t?'⚠️':'ℹ️'}</span><span class="alert-message">${e}</span><button class="alert-close" onclick="this.parentElement.parentElement.remove()">×</button></div>`,n.appendChild(o),setTimeout(()=>{o.parentNode&&o.remove()},5e3)}}limpiarAlertas(){const e=document.getElementById('alert-container');e&&(e.innerHTML='')}mostrarError(e,t){const n=e.parentNode.querySelector('.error-container');n&&(n.innerHTML='',e.classList.add('error'))}limpiarMensajesError(){document.querySelectorAll('.error-container').forEach(e=>{e.innerHTML=''}),document.querySelectorAll('.input-field input').forEach(e=>{e.classList.remove('error')}}}document.addEventListener('DOMContentLoaded',()=>{new DivisionCalculator});